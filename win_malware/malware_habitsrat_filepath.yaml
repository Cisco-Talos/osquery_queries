malware_habitsrat_filepath:
  description: 'A filepath associated with HabitsRAT malware was detected. HabitsRAT
    is a backdoor that allows the malware operator to execute arbitrary code on the
    infected machine. It copies itself into C:\Windows\Defender\MsMpEng.exe. It creates
    a scheduled task through a XML file written in %TEMP% directory. A RSA-2048 key
    is used to encrypt and authenticate commands from the C2 server. The C2 server
    name is stored in C:\Windows\Defender\Defender.dll and RSA-2048 private key is
    stored in C:\Windows\Defender\MsMpEng.dll. '
  interval: 86400
  mitre_tactics:
  - Execution: TA0002
  mitre_techniques:
  - Scheduled Task: T1053
  platform:
  - windows
  query: SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode, f.size,
    DATETIME(f.atime, 'unixepoch', 'UTC') AS last_access_time, DATETIME(f.mtime, 'unixepoch',
    'UTC') AS last_modified, DATETIME(f.ctime, 'unixepoch', 'UTC') AS last_status_change_time,
    DATETIME(f.btime, 'unixepoch', 'UTC') AS creation_time, f.type FROM file f LEFT
    JOIN hash h ON f.path=h.path WHERE (f.directory LIKE 'C:\Windows\Defender' AND
    f.filename LIKE regex_match(f.filename, 'MsMpEng\.(exe|dll)|Defender\.dll', 0));
  references:
  - https://www.virustotal.com/gui/file/29ebf9771e52cde90776eeccd89aaf4c19577ef136258daef1a17c767ce88c9d/detection
  snapshot: true
