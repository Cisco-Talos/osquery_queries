malware_puzzlemaker_filepath:
  description: 'A filepath associated with a RAT attributed to Puzzlemaker threat
    actor was detected. Two PE files are dropped into the %SYSTEM% directory. WmiPrvMon.exe
    is installed as a service and launches the other dropped PE, wmimon.dll which
    is the main payload. It contains the hardcoded C2 server URL and is capable of
    downloading and uploading files, creating processes and deleting itself. All communications
    with the C2 is encrypted. '
  interval: 86400
  mitre_tactics:
  - Persistence: TA0003
  - Command and Control: TA0011
  mitre_techniques:
  - New Service: T1050
  - Standard Cryptographic Protocol: T1032
  platform:
  - windows
  query: 'SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode,
    f.size, DATETIME(f.atime, ''unixepoch'',''UTC'') AS last_access_time, DATETIME(f.mtime,
    ''unixepoch'', ''UTC'') AS last_modified, DATETIME(f.ctime, ''unixepoch'', ''UTC'')
    AS last_status_change_time, DATETIME(f.btime, ''unixepoch'', ''UTC'') AS creation_time,
    f.type FROM file f LEFT JOIN hash h ON f.path=h.path WHERE (f.directory=''C:\Windows\System32''
    AND (LOWER(f.filename)=''wmiprvmon.exe'' OR LOWER(f.filename)=''wmimon.dll'')); '
  references:
  - www.virustotal.com/gui/file/982f7c4700c75b81833d5d59ad29147c392b20c760fe36b200b541a0f841c8a9/detection
  - www.virustotal.com/gui/file/8a17279ba26c8fbe6966ea3300fdefb1adae1b3ed68f76a7fc81413bd8c1a5f6/detection
  snapshot: true
