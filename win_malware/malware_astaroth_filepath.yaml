malware_astaroth_filepath:
  query: SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode, f.size,
    DATETIME(f.atime, "unixepoch","UTC") AS last_access_time, DATETIME(f.mtime, "unixepoch",
    "UTC") AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS last_status_change_time,
    DATETIME(f.btime, "unixepoch", "UTC") AS creation_time FROM file f JOIN hash h
    ON f.path=h.path WHERE f.path LIKE "C:\Users\%\AppData\Roaming\%%\sqlite3.dll"
    AND f.directory LIKE regex_match(f.directory, ".*AppData\\Roaming\\[A-Z]{3}[0-9]{11}[A-Z]",
    0) AND f.filename LIKE "sqlite3.dll";
  interval: 86400
  snapshot: true
  description: A filepath associated with Astaroth was detected. Astaroth is infostealer
    malware that has evolved over time to leverage living-off-the-land evasion techniques
    while remaining fileless in its execution. Most recently, it uses legitimate Windows
    binary ExtExport.exe to load malicious DLL's.
  platform:
  - windows
