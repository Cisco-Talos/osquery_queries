ransomware_hansom_registry_persistence:
  query: 'SELECT key, path, name, data, DATETIME(mtime, "unixepoch", "UTC") AS last_modified FROM registry WHERE (key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\Run" OR key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\RunOnce") AND name="HANSOM" AND data LIKE regex_match(data,"^regsvr32\.exe\s\/s\s[A-Z]:\\.+\.dll$",0); '
  interval: 86400
  snapshot: true
  description: Hansom is a ransomware plugin used by the CRAT malware family. Instead of encrypting targeted files, Hansom will generate random passwords and use them to protect RAR archives containing the files held for ransom. The passswords are archived themselves and encrypted with a public key.
  references:
  - https://www.virustotal.com/gui/file/cb141c743ac41784501e2e84ccd9969aade82b296df077daff3c0734bb26c837
  mitre_tactics:
  - Persistence: TA0003
  mitre_techniques:
  - Registry Run Keys: T1060
  platform:
  - windows
