malware_bandook_registry_key:
  description: Bandook is a Remote Access Trojan (RAT) known for spying corporate
    networks in Latin America. Attacks associated with Bandook usually start with
    emails that contain a PDF with a malicious link as an attachment. The link downloads
    a compressed archive with the dropper that eventually injects Bandook into an
    Internet Explorer process. Bandook collects information about the victim and sends
    it to its Command and Control (C&C) server. The most recent Bandook variants are
    also capable of recording sound, taking screenshots, using the victim's webcam
    and manipulating programs like Skype and TeamViewer. To achieve persistence, this
    threat adds its file path to a registry key.
  interval: 86400
  mitre_tactics:
  - Persistence: TA0003
  mitre_techniques:
  - Modify Registry: T1112
  platform:
  - windows
  query: 'SELECT key, path, name, data, datetime(mtime, "unixepoch", "UTC") AS last_modified FROM registry WHERE (((key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\Run" OR key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\Explorer\RunMRU") AND data LIKE regex_match(data,".+AppData\\Roaming\\[a-z]{20}\\[a-z]{20}\.exe", 0)) OR (key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion" AND data LIKE "QzpcVXNlcnNc%") OR (key LIKE "HKEY_USERS\S-%\Software%%" AND name IN ("AMMY132", "api", "gn", "mep", "pim", "rno1", "tvn", "DRT3", "idate", "der333f", "FDFfda", "NVhfhfjs"))); '
  references:
  - www.virustotal.com/gui/file/51367cf1a79f11c5801c47f1fbe68c765c1e90602cb7ff49dc00af5e2701c9d5/detection
  - www.virustotal.com/gui/file/d3e7b5be903eb9a596b9b2b78e5dd28390c6aadb8bdd4ea1ba3d896d99fa0057/detection
  snapshot: true
