malware_CRAT_loader_registry_persistence:
  query: 'SELECT key, path, name, data, datetime(mtime, "unixepoch", "UTC") AS last_modified FROM registry WHERE (key LIKE "HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager" AND name="PendingFileRenameOperations" AND data LIKE regex_match(data,"^.:\\Windows\\system32\\MstscConfig\.exe$",0)) OR ((key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\Run" OR key LIKE "HKEY_USERS\S-%\Software\Microsoft\Windows\CurrentVersion\RunOnce") AND ((name="Microsoft Internet Explorer" AND data LIKE regex_match(data,".+\.exe$",0)) OR (name="MaintenanceService" AND data LIKE regex_match(data,".+AppData\\Local\\Mozilla\\Maintenance\sService\\MaintenanceService.exe.lnk$",0)))); '
  interval: 86400
  snapshot: true
  description: The CRAT malware family consists of multiple RAT capabilities, additional
    plugins and a variety of detection-evasion techniques. Linked attacks consists of a
    highly modular malware that can function as a standalone RAT and  download and activate
    additional malicious plugins from its C2 servers. The core module is often injected
    and reflected into process memory address space by a PE loader. The loader will establish
    persistence on the infected host before executing code for anti-analysis checks.
  references:
  - https://www.virustotal.com/gui/file/2916801be5b6d26d735aaa11eb5631fc6dbe234ed2e0980b8d7366c89ad7ba39
  mitre_tactics:
  - Persistence: TA0003
  mitre_techniques:
  - Registry Run Keys: T1060
  platform:
  - windows
