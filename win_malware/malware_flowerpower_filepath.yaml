malware_flowerpower_filepath:
  query: 'SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode,
    f.size, DATETIME(f.atime, "unixepoch","UTC") AS last_access_time, DATETIME(f.mtime,
    "unixepoch", "UTC") AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS
    last_status_change_time, DATETIME(f.btime, "unixepoch", "UTC") AS creation_time,
    f.type FROM file f LEFT JOIN hash h ON f.path=h.path WHERE f.path LIKE regex_match(f.path,
    ".*\\AppData\\.*\\(\S+)\\\1\.hwp", 0);  '
  interval: 86400
  snapshot: true
  description: A filepath associated with FlowerPower was detected. FlowerPower is
    a PowerShell script that is capable of collecting system information - items in
    Recent, Program Files, Program Files (x86) folders, systeminfo command output
    and list of running processes (through tasklist command). The collected information
    is stored in a .hwp file in a sub-directory within %APPDATA%. It is then exfiltrated
    to the C2. It is also capable of executing encoded commands received from the
    C2.
  references:
  - www.virustotal.com/gui/file/d36ac36d278c264362ec31e116a46daaa4a7287a9dcd689d665a5ab1fd5416b8/detection
  - www.virustotal.com/gui/file/2d5058b9db4cf0440bb285c3b83bdb2cd802a25677e42f2a2c6f62c0124946cb/detection
  - www.virustotal.com/gui/file/25d07f7c0b7bf398d964d906c42b4b58597467f409abb5567b9596ccebdcf1cb/detection
  mitre_tactics:
  - Execution: TA0002
  - Command and Control: TA0011
  mitre_techniques:
  - Data Encoding: T1132
  platform:
  - windows
