ransomware_pay2key_filepath:
  query: 'SELECT f.path, f.filename, h.sha256, f.uid, f.gid, f.mode, f.size, DATETIME(f.atime,
    "unixepoch","UTC") AS last_access_time, DATETIME(f.mtime, "unixepoch", "UTC")
    AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS last_status_change_time,
    DATETIME(f.btime, "unixepoch", "UTC") AS creation_time, f.type FROM file f
    LEFT JOIN hash h ON f.path=h.path WHERE f.path LIKE "%Cobalt-Client-log.txt"
    AND f.path NOT LIKE "%\Recent" AND f.path NOT LIKE "%backup%"; '
  interval: 86400
  snapshot: true
  description: Pay2Key ransomware was first discovered after a series of attacks against
    Israeli companies. It propagates via Remote Desktop Protocol (RDP) and executes
    using PsExec. To communicate with the command and control (C2), Pay2Key needs
    to read the Server and Port keys from a configuration file. The command and control
    then supplies an RSA public key that is used to cipher the RC4 key used to encrypt
    the victim's files. Pay2Key is also known for using a log file called Cobalt-Client-log.txt
    during its execution.
  references:
  - https://www.virustotal.com/gui/file/5bae961fec67565fb88c8bcd3841b7090566d8fc12ccb70436b5269456e55c00/detection
  mitre_tactics:
  - Impact: TA0040
  mitre_techniques:
  - Data Encrypted for Impact: T1486
  platform:
  - windows
