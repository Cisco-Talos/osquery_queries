malware_kimsuky_file:
  query: 'SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode,
    f.size, DATETIME(f.atime, "unixepoch", "UTC") AS last_access_time, DATETIME(f.mtime,
    "unixepoch", "UTC") AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS
    last_status_change_time,DATETIME(f.btime, "unixepoch", "UTC") AS creation_time,
    f.type FROM file f LEFT JOIN hash h ON f.path=h.path WHERE (f.path LIKE "C:\Users\%\AppData\Roaming\qwer.txt"
    OR f.path LIKE "C:\Users\%\AppData\Roaming\Microsoft\desktop.ini"); '
  interval: 86400
  snapshot: true
  description: Kimsuky, a North Korean APT, has been known for delivering malware
    to high-value targets. The initial vector is a maldoc which drops a VBS file to
    disk which then sets up persistence and downloads additional modules. Their information
    gathering and keylogger malware look for a specific file in %APPDATA% path. If
    the file does not exist, they do not display malicious behavior. This signature
    looks for those two files.
  references:
  - https://www.virustotal.com/gui/file/dddc57299857e6ecb2b80cbab2ae6f1978e89c4bfe664c7607129b0fc8db8b1f
  mitre_tactics:
  - Execution: TA0002
  - Discovery: TA0007
  mitre_techniques:
  - Command and Scripting Interpreter: T1059
  - File and Directory Discovery: T1083
  platform:
  - windows
