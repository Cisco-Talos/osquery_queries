ransomware_mespinoza_registry_keys:
  query: 'SELECT key AS reg_key, path, name, data, datetime(mtime, "unixepoch", "UTC")
    as last_modified FROM registry WHERE key LIKE "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System"
    AND name IN ("legalnoticetext", "legalnoticecaption") AND data IN ("PYSA", "encrypted"); '
  interval: 86400
  snapshot: true
  description: Mespinoza, also known as Pysa, is a ransomware known for encrypting
    files on the infected system, usually appending the "pysa" extension although
    some variants might use other extensions, such as "locked". Mespinoza is also
    known for storing the ransom note in theregistry, to make it persistent. After
    the infection it deletes itself using a dropped batch file. This ransomware generates
    a key for every file it encrypts.
  references:
  - https://www.virustotal.com/gui/file/af99b482eb0b3ff976fa719bf0079da15f62a6c203911655ed93e52ae05c4ac8/behavior
  mitre_tactics:
  - Persistence: TA0003
  - Impact: TA0040
  mitre_techniques:
  - Modify Registry: T1112
  - Data Encrypted for Impact: T1486
  platform:
  - windows
