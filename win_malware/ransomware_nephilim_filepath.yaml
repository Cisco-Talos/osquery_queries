ransomware_nephilim_filepath:
  query: 'SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode,
    f.size, DATETIME(f.atime, "unixepoch","UTC") AS last_access_time, DATETIME(f.mtime,
    "unixepoch", "UTC") AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS
    last_status_change_time, DATETIME(f.btime, "unixepoch", "UTC") AS creation_time,
    f.type FROM file f LEFT JOIN hash h ON f.path=h.path WHERE ((f.directory LIKE
    "C:\Users\%%" AND (f.filename LIKE regex_match(f.filename, "\S+\.(N|M)E(PH|F)(I|1)L(I|1)(N|M)$",
    0) OR f.filename LIKE regex_match(f.filename, "\S+\.OFFWHITE$", 0) OR f.filename
    LIKE regex_match(f.filename, "\S+\.TELEGRAM$", 0) OR f.filename LIKE regex_match(f.filename,
    "\S+\.SIGARETA$", 0) OR f.filename LIKE regex_match(f.filename, "\S+\.TRAPGET$",
    0))) OR (f.directory = "C:" AND (f.filename LIKE regex_match(f.filename, "NE(PH|F)(I|1)L(I|1)(N|M)-(README|DECRYPT)\.\S+",
    0) OR f.filename LIKE regex_match(f.filename, "OFFWHITE-MANUAL\.\S+", 0) OR f.filename
    LIKE regex_match(f.filename, "TELEGRAM-RECOVER\.\S+", 0) OR f.filename LIKE regex_match(f.filename,
    "SIGARETA-RESTORE\.\S+", 0) OR f.filename LIKE regex_match(f.filename, "TRAPGET-INSTRUCTION\.\S+",
    0))));  '
  interval: 86400
  snapshot: true
  description: A filepath associated with Nephilim was detected. Nephilim, also called
    Nefilim, is a ransomware used in targeted attacks, particularly against oil and
    energy companies. It is usually delivered via vulnerable RDP services. The encryption
    is done with a combination of AES-128 for the files and RSA-2048 to encrypt the
    AES key. After infection, encrypted files are given one of the following extensions
    - .NEFILIM, .NEF1LIM, .NEPHILIM, .MEFILIN, .NEPHILIN, .TELEGRAM, .OFFWHITE, .SIGARETA
    and .TRAPGET
  references:
  - https://www.virustotal.com/gui/file/08c7dfde13ade4b13350ae290616d7c2f4a87cbeac9a3886e90a175ee40fb641/detection
  - https://www.virustotal.com/gui/file/4d2173874fa4782247f33413de10cc6ab2784d04946f75c36492b9f572249a96/detection
  - https://www.virustotal.com/gui/file/0bafde9b22d7147de8fdb852bcd529b1730acddc9eb71316b66c180106f777f5/detection
  - https://www.virustotal.com/gui/file/21873b75c829aa37d30c87e1bc29bebd042f7f3594d5373749270c42ab7c042f/detection
  - https://www.virustotal.com/gui/file/24ada19b269279612370bdf16f2becc1d5b7e0f69821050e2d9b48cfc874dca0/detection
  - https://www.virustotal.com/gui/file/353ee5805bc5c7a98fb5d522b15743055484dc47144535628d102a4098532cd5/detection
  - https://www.virustotal.com/gui/file/706a4b0e0b4fd4a2347e0c3ee1281182a04b4a89631aa934e6b48673c463fba4/detection
  - https://www.virustotal.com/gui/file/9e6be0a3bf10410a43c979902507647a4e4f4625a1470ad1ed90e460183b5995/detection
  - https://www.virustotal.com/gui/file/b8066b7ec376bc5928d78693d236dbf47414571df05f818a43fb5f52136e8f2e/detection
  mitre_tactics:
  - Execution: TA0002
  - Impact: TA0040
  mitre_techniques:
  - Data Encrypted for Impact: T1486
  platform:
  - windows
