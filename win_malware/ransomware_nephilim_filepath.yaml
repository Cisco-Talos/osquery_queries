ransomware_nephilim_filepath:
  query: 'SELECT f.path, f.directory, f.filename, h.sha256, f.uid, f.gid, f.mode,
    f.size, DATETIME(f.atime, "unixepoch","UTC") AS last_access_time, DATETIME(f.mtime,
    "unixepoch", "UTC") AS last_modified, DATETIME(f.ctime, "unixepoch", "UTC") AS
    last_status_change_time, DATETIME(f.btime, "unixepoch", "UTC") AS creation_time,
    f.type FROM file f LEFT JOIN hash h ON f.path=h.path WHERE ((f.directory LIKE
    "C:\Users\%%" AND (f.filename LIKE regex_match(f.filename, "\S+\.NE[PH|F][I|1]L[I|1][N|M]",
    0))) OR (f.directory LIKE regex_match(f.directory, "\S+\\AppData\\Local\\Temp\\IXP[0-9]{3}.TMP",
    0) AND (f.filename LIKE regex_match(f.filename, "TMP[0-9]{4}\$\.TMP", 0) OR f.filename
    LIKE regex_match(f.filename, "\S+\.[eE][xX][eE]", 0)))); '
  interval: 86400
  snapshot: true
  description: A filepath associated with Nephilim was detected. Nephilim, also called
    Nefilim, is a ransomware used in targeted attacks, particularly against oil and
    energy companies. It is usually delivered via vulnerable RDP services. The encryption
    is done with a combination of AES-128 for the files and RSA-2048 to encrypt the
    AES key. After infection, encrypted files are given extension - .NEFILIM, .NEF1LIM,
    .NEPHILIM and other similar variations.
  references:
  - https://www.virustotal.com/gui/file/52e25bdd600695cfed0d4ee3aca4f121bfebf0de889593e6ba06282845cf39ea/detection
  - https://www.virustotal.com/gui/file/c2b9f3b84e3e990e2c225e05ea65e7a3aaaf5a688864d0ee68ed2eece557fac0/detection
  mitre_tactics:
  - Execution: TA0002
  - Impact: TA0040
  mitre_techniques:
  - Data Encrypted for Impact: T1486
  platform:
  - windows
